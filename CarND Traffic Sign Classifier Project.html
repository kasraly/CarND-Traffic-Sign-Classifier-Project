<h1 id="traffic-sign-recognition"><strong>Traffic Sign Recognition</strong></h1>

<hr>

<p><strong>Build a Traffic Sign Recognition Project</strong></p>

<p>The goals / steps of this project are the following: <br>
* Load the data set (see below for links to the project data set) <br>
* Explore, summarize and visualize the data set <br>
* Design, train and test a model architecture <br>
* Use the model to make predictions on new images <br>
* Analyze the softmax probabilities of the new images <br>
* Summarize the results with a written report</p>



<h2 id="rubric-points">Rubric Points</h2>



<h3 id="here-i-will-consider-the-rubric-points-individually-and-describe-how-i-addressed-each-point-in-my-implementation">Here I will consider the <a href="https://review.udacity.com/#!/rubrics/481/view">rubric points</a> individually and describe how I addressed each point in my implementation.</h3>

<hr>



<h3 id="files-submitted">Files Submitted</h3>

<p>I am submitting this report alongside the project code found <a href="https://github.com/kasraly/CarND-Traffic-Sign-Classifier-Project/blob/master/Traffic_Sign_Classifier.ipynb">here</a>.</p>



<h3 id="dataset-exploration">Dataset Exploration</h3>



<h4 id="dataset-summary">Dataset Summary</h4>

<p>I used the numpy function to calculate some  summary statistics of the traffic <br>
signs data set:</p>

<ul>
<li>The size of training set is 34799</li>
<li>The size of the validation set is 4410</li>
<li>The size of test set is 12630</li>
<li>The shape of a traffic sign image is 32x32x3, i.e. 32x32 pixels with separate red, green and blue colors. </li>
<li>The number of unique classes/labels in the data set is 43</li>
</ul>



<h4 id="2-include-an-exploratory-visualization-of-the-dataset">2. Include an exploratory visualization of the dataset.</h4>

<p>I examined the data visually first by plotting some examples. Below are images of some of training data traffic signs  <br>
<img title="Training Data Traffic Sign 1" alt="alt text" src="./resources/train_image1.png"> <img title="Training Data Traffic Sign 2" alt="alt text" src="./resources/train_image2.png"> <img title="Training Data Traffic Sign 3" alt="alt text" src="./resources/train_image3.png"> <img title="Training Data Traffic Sign 4" alt="alt text" src="./resources/train_image4.png"> <br>
To my surprise, images do not have very good quality and have varying luminance. I have to admit that I was not able to classify some of them, and had doubt about the performance of the classification algorithm.  <br>
I was also curios to see how is the distribution of the classes between training, validation and test data. figure below show the number of samples in each class for training, validation and test data. Although the number of samples for different classes vary, for each class the proportion of samples is similar between training, validation and test data, which is a good sign. </p>

<p><img title="Number of each class data samples" alt="alt text" src="./resources/histogram.png"></p>



<h3 id="design-and-test-a-model-architecture">Design and Test a Model Architecture</h3>



<h4 id="1-preprocessing">1. Preprocessing</h4>

<p>I decided not to change the color to grayscale, as color has some important information in traffic sign. Additionally, grayscale is a linear combination of the three colors, and if that info in necessary, hopefully the neural net will find the relation by itself. </p>

<p>I was planning to normalize the brightness of the images, as some images were very dark. However, I got reasonably good result without normalizing the brightness and decided to not do it.</p>

<p>Of course to ensure proper operation of the neural network we need to normalize the input. I chose to normalize the values to between 0 and 1. I used the following formula to normalize the input data: x = (x - x_min)/(x_max - x_min). <br>
Note that x_max and x_min will be calculated based on training data and will be used for validation and test data as well.  <br>
Normalization is needed to ensure that all inputs have the same scale. Additionally, it helps to keep the initial output of the network close to the desired magnitude (0 and 1 for on-hot mapping) and prevent excessively large errors. </p>



<h4 id="2-model-architecture">2. Model Architecture</h4>

<p>I started with the Le-Net architecture and built on top of that.  <br>
My final model consisted of the following layers:</p>

<table>
<thead>
<tr>
  <th align="center">Layer</th>
  <th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">Input</td>
  <td align="center">32x32x3 RGB image</td>
</tr>
<tr>
  <td align="center">Convolution 5x5</td>
  <td align="center">1x1 stride, valid padding, outputs 28x28x10</td>
</tr>
<tr>
  <td align="center">RELU</td>
  <td align="center"></td>
</tr>
<tr>
  <td align="center">Max pooling</td>
  <td align="center">2x2 stride,  outputs 14x14x10</td>
</tr>
<tr>
  <td align="center">Convolution 5x5</td>
  <td align="center">1x1 stride, valid padding, outputs 10x10x16</td>
</tr>
<tr>
  <td align="center">RELU</td>
  <td align="center"></td>
</tr>
<tr>
  <td align="center">Max pooling</td>
  <td align="center">2x2 stride,  outputs 5x5x16</td>
</tr>
<tr>
  <td align="center">Dropout</td>
  <td align="center">50% dropout probability</td>
</tr>
<tr>
  <td align="center">Fully connected (input 400)</td>
  <td align="center">outputs 120</td>
</tr>
<tr>
  <td align="center">RELU</td>
  <td align="center"></td>
</tr>
<tr>
  <td align="center">Dropout</td>
  <td align="center">50% dropout probability</td>
</tr>
<tr>
  <td align="center">Fully connected (input 120)</td>
  <td align="center">outputs 84</td>
</tr>
<tr>
  <td align="center">RELU</td>
  <td align="center"></td>
</tr>
<tr>
  <td align="center">Output layer - fully connected (input 84)</td>
  <td align="center">outputs 43 (classes)</td>
</tr>
</tbody></table>




<h4 id="3-model-training">3. Model Training</h4>

<p>To minimize the number of hyper parameters I utilized the “adamoptimizer” for the training. Adamoptimizer will adaptively change the learning rate based on the variations in the gradient. Therefore, there is no need to change the learning rate gradually.</p>

<p>I started with the initial learning rate of 0.001 and achieved reasonably good result. </p>

<p>With regard to batch size, I first started with large batch size of 1024. However, the learning was relatively slow. I believe this is due to lower number of updates. Since effectively the number of updates in each epoch is total training samples divided by batch size. <br>
I could have increased the learning rate to speed up the training, but decided to decrease the batch size to have more updates per epoch. After trial and error, I chose the batch size of 64.</p>

<p>Regarding Epochs, I started with 10 Epochs, but could see that both training and validation accuracy is still increasing after 10 epochs. So I increased the epochs to 20, and this time the validation accuracy plateaued after around 15 epochs. Since the training accuracy was also staying constant at this point (slightly below 1 of course), I was not worried about over fitting and kept the number of epochs at 20. </p>



<h4 id="4-solution-approach">4. Solution Approach</h4>

<p>My final model results were: <br>
* training set accuracy of 0.992 <br>
* validation set accuracy of 0.959 <br>
* test set accuracy of 0.952</p>

<p>I started with the Le-Net architecture from the course. Le-Net architecture provides two convolution layers that can extract desired visual features from the image. The convolution layers are followed by three fully connected layers that provide the nonlinear mapping between features and the classes. </p>

<p>While it was suggested to normalize the input between -1 and 1, I decided to normalize the data between 0 and 1. Since the weights are already randomized and can have negative values, I felt a having inputs between 0 and 1 would be a better choice. </p>

<p>I chose to not include the softmax module at the final layer. since the desired one-hot values are 0 and 1 and the softmax output reaches those values with infinity inputs. therefore it might cause the weight to increase unnecessarily.</p>

<p>The original Le-Net architecture resulted in relatively good training accuracy, but from the beginning the validation data accuracy was significantly lower than training data. So I suspected that that we are over fitting to the training data.  <br>
I reduced the number of outputs in each layer to reduce the size of network and decrease the chance of over fitting. But that did not help much with over fitting, while the training data accuracy reduced. <br>
I decided to add a dropout layer after each nonlinear function (4 dropout layers in total). the dropout layers significantly helped with the over fitting and brought training and validation accuracy in the same ballpark. however, the training accuracy was not satisfactory. <br>
I increased the output size of layers to provide more freedom for training. but the training accuracy did not get close to 1.  <br>
Finally, I decided to remove the dropout layer from the first and last nonlinear layers. leaving two dropout layers in the middle of network, one after the second convolution result and one after the first fully connected result. my rational was that these two dropout layers will prevent enough information from input to output to overcome over fitting without crippling the neural network too much. <br>
With this setup I was able to achieve the above result. </p>



<h3 id="test-a-model-on-new-images">Test a Model on New Images</h3>



<h4 id="1-acquiring-new-images">1. Acquiring New Images</h4>

<p>I used the following set of traffic signs from the internet and used them to test the classifier. </p>

<p><img title="New Signs" alt="alt text" src="./resources/German_road_signs.jpg"></p>

<p>I cropped the signs and resized them to 32 by 32 pixels. the result were images below:</p>

<p><img title="New Signs Transformed" alt="alt text" src="./resources/new_signs_transformed"></p>



<h4 id="2-performance-on-new-images">2. Performance on New Images</h4>

<p>Here are the results of the prediction:</p>

<table>
<thead>
<tr>
  <th align="center">#</th>
  <th align="center">Image</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">1</td>
  <td align="center">No Stopping</td>
  <td align="center">Speed limit (30km/h)</td>
</tr>
<tr>
  <td align="center">2</td>
  <td align="center">No parking</td>
  <td align="center">Keep right</td>
</tr>
<tr>
  <td align="center">3</td>
  <td align="center">speed limit 60kph</td>
  <td align="center">Speed limit (60km/h)</td>
</tr>
<tr>
  <td align="center">4</td>
  <td align="center">end speed zone</td>
  <td align="center">End of speed limit (80km/h)</td>
</tr>
<tr>
  <td align="center">5</td>
  <td align="center">no passing</td>
  <td align="center">No passing</td>
</tr>
<tr>
  <td align="center">6</td>
  <td align="center">end no passing zone</td>
  <td align="center">End of no passing</td>
</tr>
<tr>
  <td align="center">7</td>
  <td align="center">caution</td>
  <td align="center">General caution</td>
</tr>
<tr>
  <td align="center">8</td>
  <td align="center">one way</td>
  <td align="center">End of no passing</td>
</tr>
<tr>
  <td align="center">9</td>
  <td align="center">freeway</td>
  <td align="center">Go straight or left</td>
</tr>
<tr>
  <td align="center">10</td>
  <td align="center">end freeway</td>
  <td align="center">End of no passing</td>
</tr>
<tr>
  <td align="center">11</td>
  <td align="center">parking disc</td>
  <td align="center">Go straight or left</td>
</tr>
</tbody></table>


<p>At first it seemed that the system only predicted 5 signs out of 11 signs resulting in about 45% accuracy. Which is a huge discrepancy with test data result. However, after examining all the classes, I observed that only 5 of the new signs are from classes defined in the dataset, therefore the model was able to correctly guess 5 of the 5 traffic signs, which gives an accuracy of 100%. This result is inline with the test data accuracy. However, we only have 5 images and to accurately decide on the classification accuracy we need many more images. </p>



<h4 id="3-model-certainty-softmax-probabilities">3. Model Certainty - Softmax Probabilities</h4>

<p>Here I only discuss the 5 images that have proper classes. images 3 to 7 above. <br>
My model does not have a softmax layer at the end, so I applied a softmax function to my logit outputs to calculate the probabilities below.  <br>
For the first image (speed limit 60kph), the model is completely sure that this is a 60kph speed limit sign (probability of 0.999). The other top three guesses are also all speed limits signs with varying speed limits.</p>

<table>
<thead>
<tr>
  <th align="center">Probability</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">.999</td>
  <td align="center">Speed limit (60km/h)</td>
</tr>
<tr>
  <td align="center">.001</td>
  <td align="center">Speed limit (50km/h)</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Speed limit (80km/h)</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Speed limit (30km/h)</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">No passing</td>
</tr>
</tbody></table>


<p>For the second image (end speed zone ), the model is relatively sure that this is a End of speed limit (80km/h) sign (probability of 0.914). I actually did no find End of speed limit sign with 60kph value in the classes. the lower probability than previous image can be due to the fact that this image has not been in the training data. that being said, two other guesses of the classifier are also speed limit related with lower probabilities. </p>

<table>
<thead>
<tr>
  <th align="center">Probability</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">.914</td>
  <td align="center">End of speed limit (80km/h)</td>
</tr>
<tr>
  <td align="center">.070</td>
  <td align="center">End of all speed and passing limits</td>
</tr>
<tr>
  <td align="center">.014</td>
  <td align="center">Speed limit (60km/h)</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">End of no passing by vehicles over 3.5 metric tons</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Speed limit (30km/h)</td>
</tr>
</tbody></table>


<p>For the third image (no passing), the model is completely sure that this is a No passing sign (probability of 1).  </p>

<table>
<thead>
<tr>
  <th align="center">Probability</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">1.000</td>
  <td align="center">No passing</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Vehicles over 3.5 metric tons prohibited</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">No passing for vehicles over 3.5 metric tons</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">End of no passing</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Slippery road</td>
</tr>
</tbody></table>


<p>For the fourth image (end no passing zone), the model is completely sure that this is a End of no passing sign (probability of 0.997).  </p>

<table>
<thead>
<tr>
  <th align="center">Probability</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">0.997</td>
  <td align="center">End of no passing</td>
</tr>
<tr>
  <td align="center">.002</td>
  <td align="center">End of all speed and passing limits</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">End of no passing by vehicles over 3.5 metric tons</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Go straight or right</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Speed limit (100km/h)</td>
</tr>
</tbody></table>


<p>For the fifth image (caution), the model is completely sure that this is a General caution sign (probability of 1).  that being said, other top guesses of the classifier all have a triangular sign, which is reasonable.</p>

<table>
<thead>
<tr>
  <th align="center">Probability</th>
  <th align="center">Prediction</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">1.000</td>
  <td align="center">General caution</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Pedestrians</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Traffic signals</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Road narrows on the right</td>
</tr>
<tr>
  <td align="center">.000</td>
  <td align="center">Bicycles crossing</td>
</tr>
</tbody></table>




<h2 id="references">References</h2>

<p>[1] An overview of gradient descent optimization algorithms, <a href="http://sebastianruder.com/optimizing-gradient-descent/index.html">http://sebastianruder.com/optimizing-gradient-descent/index.html</a></p>

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>